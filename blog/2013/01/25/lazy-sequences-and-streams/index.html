
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Lazy sequences and streams - darth10.github.com</title>
  <meta name="author" content="Akhil Wali">

  
  <meta name="description" content="">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://darth10.github.com/blog/2013/01/25/lazy-sequences-and-streams/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/jquery.min.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="darth10.github.com" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">darth10.github.com</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:darth10.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Lazy Sequences and Streams</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-25T00:00:00+05:30" pubdate data-updated="true">Jan 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Functional languages have the notion of <em>lazy sequences</em>, which are an abstraction of infinite sequences that are stored using a small, finite amount of memory.
It would be wasteful to realize an entire infinite sequence before even using it.
The basic idea is to only call the function that generates the sequence when needed, and cache the results.
With lazy sequences, you don&#8217;t blow the stack and the elements in the sequence are not recalculated everytime.</p>

<p>Let&#8217;s look at how the two most popular and functional JVM languages handle lazy sequences.</p>

<p>Clojure has the <code>lazy-seq</code> macro to create lazy sequences.
Since most functions are lazy in Clojure, sequences generated by these functions are also lazy.
Here&#8217;s how the Fibonacci sequence is implemented in Clojure.</p>

<script src="https://gist.github.com/4364961.js?file=fibo.clj"><!-- Gist  --></script>


<p>This is a really elegant implementation that uses the lazy <code>iterate</code> function.</p>

<p>Scala has the parameterized <code>Stream[T]</code> class to represent a lazy list.
Here&#8217;s what a Scala Fibonacci stream looks like.</p>

<script src="https://gist.github.com/4364961.js?file=Fibo.scala"><!-- Gist  --></script>


<p>This implementation uses the lazy right-associative <code>#::</code> function, which is actually the <code>Stream.cons</code> method.
There&#8217;s also an implicit conversion from a sequence to a stream, from the <code>Stream</code> companion object.
I&#8217;m sure Haskell programmers will eagerly point out the need for a <code>zipWith</code> function.</p>

<p>Let&#8217;s look at how these two implementations match up against eachother in terms of performance.
In Clojure, the <code>time</code> macro can be used to measure the time taken to evaluate a form.
There&#8217;s really no equivalent in Scala, so let&#8217;s implement our own.
We should be able to simply say <code>time(fiboLast(n))</code>, for example.</p>

<script src="https://gist.github.com/4364961.js?file=Time.scala"><!-- Gist  --></script>


<p>Note that the time taken to print the result of a statement in the REPL shouldn&#8217;t be measured.
We can ensure this by binding the result to a variable.
This is done by using <code>val fibo = time(fiboLast(5000)</code> in Scala, and <code>(time (def fibo (fibo-last 5000)))</code> in Clojure, for example.
Memory usage can be ignored, as the GC is invoked unpredictably.</p>

<p>And here are the results!</p>



<table border="0px">
  <tr>
    <td>
      <div id="postchart"></div>
    </td>
  </tr>
</table>




<script src="/assets/js/posts/lazy-sequences-and-streams.js" type="text/javascript">
</script>


<p>A weird observation in the Scala implementation is that <code>fiboList(1)</code> takes 8-10 milliseconds to evaluate.
But Scala actually performs better on average, which is mostly due to the use of static types.</p>

<p>Interestingly, the Clojure <code>fibo-list</code> function evaluates in constant time, which is less than a millisecond!
Clojure also fetches cached elements in the lazy sequence much faster than Scala.
However, <code>fibo-last</code> performs linearly since the <code>last</code> function has linear time-complexity.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Akhil Wali</span></span>

      








  


<time datetime="2013-01-25T00:00:00+05:30" pubdate data-updated="true">Jan 25<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://darth10.github.com/blog/2013/01/25/lazy-sequences-and-streams/" data-via="" data-counturl="http://darth10.github.com/blog/2013/01/25/lazy-sequences-and-streams/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="large"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/09/23/the-webbrowser-nightmare/" title="Previous Post: The WebBrowser nightmare">&laquo; The WebBrowser nightmare</a>
      
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
<h1>QR-Code<abbr title="The word 'QR Code' is a registered trademark of DENSO WAVE INCORPORATED. It applies only for the word 'QR Code', not for image.">&trade;</abbr></h1>
<a href="http://darth10.github.com/blog/2013/01/25/lazy-sequences-and-streams/"><img src="http://chart.apis.google.com/chart?chs=150x150&cht=qr&chld=|0&chco=165B94&chl=http://darth10.github.com/blog/2013/01/25/lazy-sequences-and-streams/" alt="post-qrcode"></a></section>

<section>
  <h1>Coderwall</h1>
  <ul id="cw_badges">
    <li class="loading">Status updating...</li>
  </ul>

  <script type="text/javascript">
    var coderwall = (function(){
      function render(options, badges){
        var fragment = '',
            t = $(options.target)[0],
            height = 65,
            width = 65,
            index;

        for (index in badges) {
          fragment += '<a class="cw_badge"title="' + badges[index].description + '" href="http://coderwall.com/' + options.user + '">';
          fragment +=   '<img alt="' + badges[index].description + '" height="' + width + '" width="' + height + '" src="' + badges[index].badge + '"/>';
          fragment += '</a>';
        }

        t.innerHTML = fragment;
      }
      return {
        showBadges: function(options){
          $.ajax({
              url: 'http://coderwall.com/' + options.user + '.json?callback=?'
            , type: 'jsonp'
            , error: function (err) { $(options.target + ' li.loading').addClass('error').text("Error loading feed"); }
            , success: function(res) {
                render(options, res.data.badges);
            }
          });
        }
      };
    })();

    $.domReady(function(){
      if (!window.jXHR){
        var jxhr = document.createElement('script');
        jxhr.type = 'text/javascript';
        jxhr.src = '/javascripts/libs/jXHR.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(jxhr, s);
      }
      if (!window.$){
        var b = document.createElement('script');
        b.type = 'text/javascript';
        b.src = '/javascripts/ender.js';
        var sc = document.getElementsByTagName('script')[0];
        sc.parentNode.insertBefore(jxhr, s);
      }
      coderwall.showBadges({
        user: 'darth10',
        target: '#cw_badges'
      });
    });
  </script>
  <style type="text/css">
    .cw_badge img {
      padding: 5px;
      border: 0 none !important;
      -moz-box-shadow: none !important;
      -webkit-box-shadow: none !important;
      -o-box-shadow: none !important;
      box-shadow: none !important;
    }
  </style>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/25/lazy-sequences-and-streams/">Lazy sequences and streams</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/09/23/the-webbrowser-nightmare/">The WebBrowser nightmare</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/16/abstract-and-parameterized-types/">Abstract and parameterized types</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/darth10">@darth10</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'darth10',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Akhil Wali -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'darth10';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://darth10.github.com/blog/2013/01/25/lazy-sequences-and-streams/';
        var disqus_url = 'http://darth10.github.com/blog/2013/01/25/lazy-sequences-and-streams/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
